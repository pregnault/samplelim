---
title: "samplelim : MCMC sampling algorithms for linear inverse models in R"
output: github_document
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE)
```

![](https://img.shields.io/badge/lifecycle-maturing-blue.svg)
[![Project Status: Active – The project has reached a stable, usable state and is being actively developed.](http://www.repostatus.org/badges/latest/active.svg)](http://www.repostatus.org/#active)
[![License: LGPL v3](https://img.shields.io/badge/License-LGPL%20v3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0)
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/regexplain)](https://cran.r-project.org/package=samplelim)

The package `{samplelim}` for the R statistical software provides efficient implementations (C++ encoded) of Monte Carlo Markov Chains (MCMC) algorithms for uniformly sampling high-dimensional polytopes. 
It is particularly convenient for solving linear inverse models (LIM) in metabolic (trophic, biochemical or urban) networks. 
Particularly, some support functions inspired by the package `{limsolve}` are designed to ease its use by ecologists practitioners.

## Objective

`{samplelim}` aims at providing efficient implementations of two MCMC algorithms for sampling high-dimensional polytopes; namely, the Mirror Walk (MiW) introduced by Van Oevelen _et al._ (2010) and the Billard Walk (BiW) introduced by Polyak and Gryazina (2014). It also provides support functions to ease its use by ecologists practitioners interested in solving LIM for trophic networks. Hence, `{samplelim}` can be viewed as an updated, extended and low-level-encoded version of the R package [`{limsolve}`](https://cran.r-project.org/web/packages/limSolve/index.html).

`{samplelim}` is built upon the C++ library [`{volesti}`](https://github.com/GeomScale/volesti). Precisely, the source code of the R package `{volesti}` 1.1.2-6 has been forked from its [GitHub repository](https://github.com/GeomScale/volesti/releases/tag/v1.1.2-6) and has served as a basis for developing `{samplelim}`.

The C++ library  `{volesti}` provides efficient implementations of several MCMC algorithms for sampling high-dimensional polytopes and estimating their volumes. Its R package counterpart includes a subset of these algorithms among which, the BiW.

The modifications and additions made by `{samplelim}` (compared to  `{volesti}` 1.1.2-6) include:

  * the removal of the bound on the number of reflections for the BiW ;
  * the introduction of the MiW. More precisely, its implementation in `{samplelim}` is an optimized, C++ encoded version of the algorithm implemented in pure R programming in `{limsolve}` ;
  * support functions inspired by `{limsolve}` making their users to be able to master `{samplelim}` very easily.

`{samplelim}` does not aim at replacing nor competing `{volesti}`, which offers high-quality contents that are not covered by `{samplelim}`. We expect `{samplelim}` to ease the junction between ecologists that are familiar with `{limsolve}` and other communities interested in sampling high-dimensional polytopes.

## Installation

The package `{samplelim}` is not yet available on CRAN mirrors. Its source code is available on GitHub. It can be installed from its repository by executing the following chunk in an R console.

```{r eval = FALSE}
if (! "remotes" %in% installed.packages()[,"Package"]) {install.packages("remotes")}
remotes::install_github("https://github.com/GrenteTheo/samplelim")
```


## Typical workflow


The workflow of `{samplelim}` is greatly inspired by the package `{limsolve}`. The main front-end function of `{samplelim}` is `rlim()`, performing uniform sampling into the polytope associated to a LIM, by means of MCMC algorithm. Its main, mandatory, argument is `lim`, a list or an object of class `lim` (introduced in `{limsolve}`) encompassing the description of the polytope to be sampled. This list or lim object can be defined by hand or, more suitably, from a description file, as illustrated in the following chunk.

```{r readdf}
# Load package
library("samplelim")
# Find path to the example of declaration file (DF) included in samplelim
DF <- system.file("extdata", "DeclarationFileBOWF-short.txt", package = "samplelim")
# Read DF and create a lim object
BOWF <- df2lim(DF)
```

Then, sampling is performed by a simple call to `rlim()`, as follows.

```{r}
sample <- rlim(lim = BOWF, 
               seed = 123, # Set the seed of PRNG
               nsamp = 5000) # Number of points in the returned sample
# The points are presented in an N*n matrix, where
# N is the number of sampled points (here, 5000, default = 3000)
# n is the number of flows (ambiant space of the polytope)
dim(sample)
```

Diagnostics on sampling performances can then be performed using packages `{coda}`, e.g., the Raftery and Lewis diagnostics, as illustrated right below.

```{r}
coda::raftery.diag(data = sample)
```
A complete user guide will be included soon in the package, in the form of a vignette.

A comparison study, including computation time and sampling quality, between the implementations of the MiW of `{samplelim}`, the BiW of `{volesti}` (1.1.2-6) and the Coordinate Hit-and-Run with Rounding (CHRR) of the MatLab library `{COBRA}`, has been performed; see Girardin _et al._ (2023).

## Credits

The modifications of the core C++ implementation of the BiW, so as the C++ implementation of the MiW, have been performed by Matthieu DIEN and Théo GRENTE. 

The R packaging has been performed by Théo GRENTE and Philippe REGNAULT.

The Declaration Files in `inst/extdata` have been produced by Quentin NOGUÈS; see Noguès _at al._ (2020) for details on the ecological network they rely on.

We refer to the [`credits.md` file](https://github.com/GeomScale/volesti/blob/v1.1.1/doc/credits.md) of the R package `{volesti}` for additional information on the development of the core C++ implementation of the BiW (and other algorithms implemented in `{volesti}`).

The function `df2lim()` (reading and formatting a declaration file) is a wrapped copy of functions `Read()` and `Setup()` from package `{LIM}`, developped by Karline SOETAERT. It has been added to the present package to limit its dependency tree.  

## Licensing 

You may redistribute or modify the software under the [GNU Lesser General Public License](LICENSE.md) as published by Free Software Foundation, either version 3 of the License, or (at your option) any later version. It is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.


## References

V. Girardin, T. Grente, N. Niquil and P. Regnault,
_Comparing and updating R packages of MCMC Algorithms
for Linear Inverse Modeling of Metabolic Networks_,
hal: 
(2023).


Q. Noguès, A. Raoux, E. Araignous, T. Hattab, B. Leroy, F. Ben Rais Lasram, F. Le Loc’h,
J. Dauvin and N. Niquil,
_Cumulative effects of marine renewable energy and climate change on 
ecosystem properties: Sensitivity of ecological network analysis_, 
Ecological Indicators __121__, 107128 
(2020).

L. Cales, A. Chalkis, I.Z. Emiris and V. Fisikopoulos, 
_Practical volume computation of structured convex bodies, and an application to modeling portfolio dependencies and financial crises_, 
Proc. of Symposium on Computational Geometry, Budapest, Hungary 
(2018).


B.T. Polyak and E.N. Gryazina, 
_Billiard walk - a new sampling algorithm for control and optimization_,
IFAC Proceedings Volumes, __47(3)__, 6123-6128 
(2014).


D. Van Oevelen, K. Van den Meersche, F. J. R. Meysman, K. Soetaert, J. J. Middelburg and
A. F. Vézina, 
_Quantifying Food Web Flows Using Linear Inverse Models_, Ecosystems __13__, 32-45
(2010).
